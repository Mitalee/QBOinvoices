{% load static %}
<html>
    <head>
        <title>OAuth2 Sample App - Intuit</title>
        <link rel="stylesheet" type="text/css" href="{% static "style.css" %}">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script>
            if (window.opener) {
                window.opener.location.href = '/app/connected'
                window.close()
            }
        </script>
        <script>
            function apiCall() {
                $("#result").html('Loading...')
                $.get("/app/qbo_request", function (data) {
                    $("#result").html(data)
                })
            }

            function revokeCall() {
                $("#result").html('Loading...')
                $.get("/app/revoke", function (data) {
                    $("#result").html(data)
                })
            }

            function refreshCall() {
                $("#result").html('Loading...')
                $.get("/app/refresh", function (data) {
                    $("#result").html(JSON.stringify(data, null, 2))
                })
            }

            function userInfoCall() {
                $("#result").html('Loading...')
                $.get("/app/user_info", function (data) {
                    $("#result").html(data)
                })
            }
            function myTokens() {
                $("#result").html('Loading...')
                $.get("/app/mytokens", function (data) {
                    console.log(data);
                    console.log(typeof(data));
                    //$("#result").html(data);
                    $("#result").html("ACCESS TOKEN IS:" + data.access_token);
                    $("#result").append("<br><br>REFRESH TOKEN IS:" + data.refresh_token);
                });
            }
            function new_access_token() {
                $("#result").html('Loading...');
                $.get("/app/newAToken", function (data) {
                    console.log(data);
                    console.log(typeof(data));
                    //$("#result").html(data);
                    $("#result").html("ACCESS TOKEN IS:" + data.access_token);
                    $("#result").append("<br><br>REFRESH TOKEN IS:" + data.refresh_token);
                });
            }
        </script>
    </head>
    <body>
        <a href="/app/">Home</a>
        <h3>Connected!</h3>
        <p>Would you like to make a sample API call?</p>
        <div>
            {% if openid %}
                <button onclick="userInfoCall()">UserInfo API Call</button>
            {% else %}
                <button onclick="apiCall()">QuickBooks API Call</button>
            {% endif %}
            <button onclick="refreshCall()">Refresh Token Call</button>
            <button onclick="revokeCall()">Revoke Token Call</button>
            <button onclick="myTokens()">My Tokens</button>
            <button onclick="new_access_token()">Get New Access Token</button>
            
            <br><br>
            <div><code id="result"></code></div>
        </div>
    </body>
</html>